<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASIA PAYMENT - Console Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        /* Styles from both files combined */
        :root {
            --primary: #0055ff;
            --secondary: #00aaff;
            --accent: #ff5500;
            --light: #ffffff;
            --dark: #212121;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --light-gray: #f8f9fa;
            --dark-gray: #343a40;
            --border: #dee2e6;
            --region: #8e44ad;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: rotate(30deg);
            animation: shine 4s infinite linear;
        }
        
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(30deg); }
            100% { transform: translateX(100%) rotate(30deg); }
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo img {
            height: 50px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        .logo h1 {
            font-size: 24px;
            font-weight: 700;
        }
        
        .auth-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .auth-info button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 15px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .auth-info button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .main-content {
            display: flex;
            min-height: 700px;
        }
        
        .sidebar {
            width: 280px;
            background: var(--light-gray);
            border-right: 1px solid var(--border);
            padding: 20px 0;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background-color: var(--primary);
            border-radius: 3px;
        }
        
        .nav-item {
            padding: 12px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            color: var(--dark);
            border-left: 4px solid transparent;
        }
        
        .nav-item i {
            width: 24px;
            text-align: center;
            font-size: 18px;
            color: var(--gray);
        }
        
        .nav-item:hover {
            background: rgba(0, 85, 255, 0.05);
            color: var(--primary);
        }
        
        .nav-item.active {
            background: rgba(0, 85, 255, 0.1);
            color: var(--primary);
            border-left: 4px solid var(--primary);
        }
        
        .nav-item.active i {
            color: var(--primary);
        }
        
        .content {
            flex: 1;
            padding: 30px;
            background: white;
            overflow-y: auto;
        }
        
        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .section-title h2 {
            font-size: 22px;
            color: var(--dark);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #0044cc;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 85, 255, 0.2);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background: #bd2130;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.2);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.2);
        }
        
        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }
        
        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.2);
        }
        
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 85, 255, 0.1);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-col {
            flex: 1;
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th {
            background: var(--light-gray);
            text-align: left;
            padding: 15px;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--border);
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        tr:hover {
            background: rgba(0, 85, 255, 0.03);
        }
        
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-provider {
            background: rgba(40, 167, 69, 0.15);
            color: var(--success);
        }
        
        .badge-static {
            background: rgba(0, 85, 255, 0.15);
            color: var(--primary);
        }
        
        .badge-postpaid {
            background: rgba(255, 133, 0, 0.15);
            color: #ff8500;
        }
        
        .badge-dynamic {
            background: rgba(108, 117, 125, 0.15);
            color: var(--gray);
        }
        
        .badge-voucher {
            background: rgba(220, 53, 69, 0.15);
            color: var(--danger);
        }
        
        .badge-url {
            background: rgba(128, 0, 128, 0.15);
            color: purple;
        }
        
        .badge-region {
            background: rgba(142, 68, 173, 0.15);
            color: var(--region);
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 6px;
        }
        
        .btn-edit {
            background: rgba(0, 85, 255, 0.1);
            color: var(--primary);
        }
        
        .btn-edit:hover {
            background: rgba(0, 85, 255, 0.2);
        }
        
        .btn-delete {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }
        
        .btn-delete:hover {
            background: rgba(220, 53, 69, 0.2);
        }
        
        .login-container {
            max-width: 500px;
            margin: 100px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
            padding: 40px;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo img {
            height: 70px;
            margin-bottom: 15px;
        }
        
        .login-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark);
            text-align: center;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            text-align: center;
            color: var(--gray);
            margin-bottom: 30px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .alert-danger {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            border: 1px solid rgba(220, 53, 69, 0.2);
        }
        
        .alert-success {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
            border: 1px solid rgba(40, 167, 69, 0.2);
        }
        
        .login-form input {
            margin-bottom: 20px;
        }
        
        .login-form button {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            margin-top: 10px;
        }
        
        footer {
            text-align: center;
            padding: 25px;
            color: var(--gray);
            font-size: 14px;
            border-top: 1px solid var(--border);
            background: var(--light-gray);
        }
        
        .loading {
            display: flex;
            justify-content: center;
            padding: 40px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 85, 255, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        .type-info {
            background: rgba(0, 85, 255, 0.05);
            border-left: 4px solid var(--primary);
            padding: 12px 15px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .type-info i {
            color: var(--primary);
            margin-right: 8px;
        }
        
        .firebase-info {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
        }
        
        /* Style tambahan untuk konten dinamis */
        .dynamic-content {
            display: none;
            padding: 20px;
        }
        
        .dynamic-content.active {
            display: block;
        }
        
        .loading-content {
            text-align: center;
            padding: 40px;
        }
        
        .content-error {
            padding: 20px;
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid rgba(220, 53, 69, 0.2);
            border-radius: 8px;
            color: var(--danger);
            margin: 20px 0;
        }
        
        .page-template {
            padding: 20px;
        }
        
        .page-template h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }
        
        /* Styles for produkcode section */
        .notification {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .notification.success {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
            border: 1px solid rgba(40, 167, 69, 0.2);
            display: block;
        }
        
        .notification.error {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
            border: 1px solid rgba(220, 53, 69, 0.2);
            display: block;
        }
        
        .input-section {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .input-section h3 {
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-section h3 i {
            font-size: 20px;
        }
        
        /* Style for prefix section */
        .prefix-table-container {
            margin-top: 20px;
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .prefix-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .prefix-table th, 
        .prefix-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .prefix-table th {
            background-color: var(--light-gray);
            font-weight: 600;
            color: var(--dark);
        }
        
        .prefix-table tr:last-child td {
            border-bottom: none;
        }
        
        .prefix-table tr:hover {
            background-color: rgba(0, 85, 255, 0.03);
        }
        
        /* Styles for UI Display section */
        .ui-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .ui-tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .ui-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }
        
        .ui-tab-content {
            display: none;
        }
        
        .ui-tab-content.active {
            display: block;
        }
        
        .banner-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 15px;
            background: var(--light-gray);
        }
        
        .banner-item img {
            width: 100px;
            height: 60px;
            object-fit: cover;
            border-radius: 6px;
        }
        
        .banner-item-details {
            flex: 1;
        }
        
        .banner-item-actions {
            display: flex;
            gap: 10px;
        }
        
        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 1px solid var(--border);
        }
        
        .mobile-preview {
            width: 300px;
            height: 600px;
            border: 2px solid var(--dark);
            border-radius: 30px;
            overflow: hidden;
            position: relative;
            margin: 0 auto;
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .mobile-header {
            height: 60px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .mobile-banner {
            height: 150px;
            position: relative;
            overflow: hidden;
        }
        
        .mobile-banner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.5s ease;
        }
        
        .mobile-content {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        .mobile-nav {
            height: 70px;
            background: #f8f9fa;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid var(--border);
        }
        
        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            color: var(--gray);
        }
        
        .mobile-nav-item.active {
            color: var(--primary);
        }
        
        .mobile-nav-item i {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .gradient-preview {
            height: 100px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
        }
        
        .color-scheme-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .logo h1 {
                font-size: 20px;
            }
            
            header {
                padding: 15px 20px;
            }
            
            .content {
                padding: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .mobile-preview {
                width: 250px;
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Section -->
        <div id="loginSection" class="login-container">
            <div class="login-logo">
                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgoChegZIJ3ZMDbPsF24DjVP68tqUjY-kl2-y_TWpfJuJLt1XHPqKEfQI_oL9-cC8iA8GaALbOP7VsgmqDWsPUaTfHSHxp6e_LOGIMy3op4C8m-12nLPXgbYGIxKeKHPb4lnKzztycM5GNBK6QwYvW0omPYX9fduw8c9K6BGj_dAv9-4acxnU1ZF6en4oA/s512/logo_asia_payment.jpg" alt="ASIA PAYMENT">
                <div class="login-title">ASIA PAYMENT Console</div>
                <div class="login-subtitle">Administrator Dashboard</div>
            </div>
            
            <div id="loginAlert" class="alert alert-danger hidden">
                <i class="fas fa-exclamation-circle"></i>
                <span id="alertMessage">Username atau password salah</span>
            </div>
            
            <div class="login-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" class="form-control" placeholder="Masukkan username">
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Masukkan password">
                </div>
                
                <button class="btn btn-primary" onclick="login()">
                    <i class="fas fa-sign-in-alt"></i> Masuk
                </button>
            </div>
        </div>
        
        <!-- Main Application (hidden until login) -->
        <div id="appSection" class="hidden">
            <header>
                <div class="logo">
                    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgoChegZIJ3ZMDbPsF24DjVP68tqUjY-kl2-y_TWpfJuJLt1XHPqKEfQI_oL9-cC8iA8GaALbOP7VsgmqDWsPUaTfHSHxp6e_LOGIMy3op4C8m-12nLPXgbYGIxKeKHPb4lnKzztycM5GNBK6QwYvW0omPYX9fduw8c9K6BGj_dAv9-4acxnU1ZF6en4oA/s512/logo_asia_payment.jpg" alt="Logo">
                    <h1>ASIA PAYMENT Console</h1>
                </div>
                
                <div class="auth-info">
                    <span id="userName">Administrator</span>
                    <button onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </header>
            
            <div class="main-content">
                <div class="sidebar">
                    <!-- Menu Utama -->
                    <div class="nav-item active" onclick="loadContent('dashboard')">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </div>
                    
                    <div class="nav-item" onclick="loadContent('categories')">
                        <i class="fas fa-layer-group"></i>
                        <span>Kategori Menu</span>
                    </div>
                    
                    <div class="nav-item" onclick="loadContent('menus')">
                        <i class="fas fa-list"></i>
                        <span>Menu Dinamis</span>
                    </div>
                    
                    <div class="nav-item" onclick="loadContent('settings')">
                        <i class="fas fa-cog"></i>
                        <span>Pengaturan</span>
                    </div>
                    
                    <!-- Menu Tampilan UI (gabungan Banner dan Color) -->
                    <div class="nav-item" onclick="loadContent('uidisplay')">
                        <i class="fas fa-paint-brush"></i>
                        <span>Tampilan UI</span>
                    </div>
                    
                    <div class="nav-item" onclick="loadContent('regex')">
                        <i class="fas fa-code"></i>
                        <span>RegexExtractor</span>
                    </div>
                    
                    <div class="nav-item" onclick="loadContent('textinfo')">
                        <i class="fas fa-info-circle"></i>
                        <span>Text Information</span>
                    </div>
                    
                    <div class="nav-item" onclick="loadContent('cs')">
                        <i class="fas fa-headset"></i>
                        <span>Customer Service</span>
                    </div>
                    
                    <div class="nav-item" onclick="loadContent('produkcode')">
                        <i class="fas fa-barcode"></i>
                        <span>Kode Produk</span>
                    </div>
                    
                    <!-- Diubah dari "Prefik Tujuan" menjadi "Provider Prefik" -->
                    <div class="nav-item" onclick="loadContent('prefix')">
                        <i class="fas fa-list-ol"></i>
                        <span>Provider Prefik</span>
                    </div>
                    
                    <div class="nav-item" onclick="loadContent('serverconfig')">
                        <i class="fas fa-server"></i>
                        <span>Server Config</span>
                    </div>
                </div>
                
                <div class="content">
                    <!-- Konten dinamis akan dimuat di sini -->
                    <div id="contentContainer">
                        <!-- Dashboard Section -->
                        <div id="dashboardSection" class="section">
                            <div class="section-title">
                                <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                                <button class="btn btn-primary" onclick="refreshData()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                            
                            <div class="card">
                                <h3>Selamat datang di Console Admin</h3>
                                <p>Gunakan panel ini untuk mengelola menu dinamis aplikasi ASIA PAYMENT.</p>
                                
                                <div class="firebase-info">
                                    <i class="fas fa-database"></i>
                                    <strong>Firebase Realtime Database</strong><br>
                                    URL: <span id="firebaseUrl">https://steady-fin-368617-default-rtdb.firebaseio.com/</span>
                                </div>
                                
                                <div class="stats-container">
                                    <div class="form-row">
                                        <div class="form-col">
                                            <div class="card">
                                                <h4><i class="fas fa-layer-group"></i> Kategori Menu</h4>
                                                <p id="categoryCount">Memuat...</p>
                                            </div>
                                        </div>
                                        
                                        <div class="form-col">
                                            <div class="card">
                                                <h4><i class="fas fa-list"></i> Total Menu</h4>
                                                <p id="menuCount">Memuat...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h3>Panduan Penggunaan</h3>
                                <ul style="padding-left: 25px; margin-top: 15px;">
                                    <li>Gunakan menu <strong>Kategori Menu</strong> untuk menambahkan atau mengelola kategori</li>
                                    <li>Di menu <strong>Menu Dinamis</strong> Anda dapat menambahkan berbagai jenis menu</li>
                                    <li>Setiap menu memiliki urutan untuk mengatur tampilan di aplikasi</li>
                                    <li>Semua perubahan akan langsung disimpan ke Firebase Realtime Database</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Categories Section -->
                        <div id="categoriesSection" class="section hidden">
                            <div class="section-title">
                                <h2><i class="fas fa-layer-group"></i> Kategori Menu</h2>
                                <button class="btn btn-primary" onclick="openCategoryForm()">
                                    <i class="fas fa-plus"></i> Tambah Kategori
                                </button>
                            </div>
                            
                            <div class="card">
                                <div class="table-container">
                                    <table id="categoriesTable">
                                        <thead>
                                            <tr>
                                                <th>Nama Kategori</th>
                                                <th>Urutan</th>
                                                <th>Jumlah Menu</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody id="categoriesTableBody">
                                            <!-- Data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Menus Section -->
                        <div id="menusSection" class="section hidden">
                            <div class="section-title">
                                <h2><i class="fas fa-list"></i> Menu Dinamis</h2>
                                <button class="btn btn-primary" onclick="openMenuForm()">
                                    <i class="fas fa-plus"></i> Tambah Menu
                                </button>
                            </div>
                            
                            <div class="card">
                                <div class="form-group">
                                    <label>Pilih Kategori</label>
                                    <select id="categoryFilter" class="form-control" onchange="filterMenus()">
                                        <option value="">Semua Kategori</option>
                                        <!-- Options will be populated -->
                                    </select>
                                </div>
                                
                                <div class="table-container">
                                    <table id="menusTable">
                                        <thead>
                                            <tr>
                                                <th>Nama Menu</th>
                                                <th>Kategori</th>
                                                <th>Tipe</th>
                                                <th>Urutan</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody id="menusTableBody">
                                            <!-- Data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Settings Section -->
                        <div id="settingsSection" class="section hidden">
                            <div class="section-title">
                                <h2><i class="fas fa-cog"></i> Pengaturan</h2>
                            </div>
                            
                            <div class="card">
                                <h3>Akun Admin</h3>
                                
                                <div class="form-group">
                                    <label for="adminUsername">Username</label>
                                    <input type="text" id="adminUsername" class="form-control" value="admin">
                                </div>
                                
                                <div class="form-group">
                                    <label for="adminPassword">Password</label>
                                    <input type="password" id="adminPassword" class="form-control" placeholder="Masukkan password baru">
                                </div>
                                
                                <div class="form-group">
                                    <label for="adminPasswordConfirm">Konfirmasi Password</label>
                                    <input type="password" id="adminPasswordConfirm" class="form-control" placeholder="Konfirmasi password baru">
                                </div>
                                
                                <button class="btn btn-primary" onclick="updateAdminAccount()">
                                    <i class="fas fa-save"></i> Simpan Perubahan
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tampilan UI Section (Banner + Color) -->
                        <div id="uidisplaySection" class="section hidden">
                            <div class="section-title">
                                <h2><i class="fas fa-paint-brush"></i> Tampilan UI</h2>
                            </div>
                            
                            <div class="ui-tabs">
                                <div class="ui-tab active" onclick="switchUiTab('banner')">Banner</div>
                                <div class="ui-tab" onclick="switchUiTab('color')">Warna</div>
                                <div class="ui-tab" onclick="switchUiTab('preview')">Preview</div>
                            </div>
                            
                            <!-- Banner Tab -->
                            <div id="bannerTab" class="ui-tab-content active">
                                <div class="card">
                                    <h3>Pengaturan Banner Slide</h3>
                                    
                                    <div class="form-group">
                                        <label for="bannerInterval">Interval Perubahan Banner (detik)</label>
                                        <input type="number" id="bannerInterval" class="form-control" min="1" value="3">
                                    </div>
                                    
                                    <button class="btn btn-primary" onclick="saveBannerInterval()">
                                        <i class="fas fa-save"></i> Simpan Interval
                                    </button>
                                    
                                    <div class="form-group" style="margin-top: 20px;">
                                        <label for="newBannerUrl">URL Banner Baru</label>
                                        <input type="text" id="newBannerUrl" class="form-control" placeholder="https://example.com/banner.jpg">
                                    </div>
                                    
                                    <button class="btn btn-success" onclick="addBanner()">
                                        <i class="fas fa-plus"></i> Tambah Banner
                                    </button>
                                    
                                    <div id="bannerList" style="margin-top: 20px;">
                                        <!-- Banner list will be populated here -->
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Color Tab -->
                            <div id="colorTab" class="ui-tab-content">
                                <div class="card">
                                    <h3>Pengaturan Warna Aplikasi</h3>
                                    
                                    <div class="form-group">
                                        <label>Background Gradient</label>
                                        <div class="form-row">
                                            <div class="form-col">
                                                <input type="color" id="gradientColor1" class="form-control" value="#ffffff">
                                            </div>
                                            <div class="form-col">
                                                <input type="color" id="gradientColor2" class="form-control" value="#FF3537">
                                            </div>
                                            <div class="form-col">
                                                <input type="color" id="gradientColor3" class="form-control" value="#FEB400">
                                            </div>
                                            <div class="form-col">
                                                <input type="color" id="gradientColor4" class="form-control" value="#FA2F62">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>Color Scheme</label>
                                        <div class="form-row">
                                            <div class="form-col">
                                                <label for="primaryColor">Primary Color</label>
                                                <input type="color" id="primaryColor" class="form-control" value="#FEB400">
                                            </div>
                                            <div class="form-col">
                                                <label for="secondaryColor">Secondary Color</label>
                                                <input type="color" id="secondaryColor" class="form-control" value="#ff5722">
                                            </div>
                                            <div class="form-col">
                                                <label for="textColor">Text Color</label>
                                                <input type="color" id="textColor" class="form-control" value="#212121">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <button class="btn btn-primary" onclick="saveColorSettings()">
                                        <i class="fas fa-save"></i> Simpan Pengaturan Warna
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Preview Tab -->
                            <div id="previewTab" class="ui-tab-content">
                                <div class="card">
                                    <h3>Preview Tampilan Mobile</h3>
                                    <p>Berikut adalah preview bagaimana tampilan aplikasi di perangkat mobile dengan pengaturan banner dan warna saat ini.</p>
                                    
                                    <div class="mobile-preview">
                                        <div class="mobile-header" id="previewHeader">
                                            ASIA PAYMENT
                                        </div>
                                        <div class="mobile-banner" id="previewBanner">
                                            <!-- Banner will be populated here -->
                                        </div>
                                        <div class="mobile-content">
                                            <h4>Selamat Datang</h4>
                                            <p>Ini adalah preview tampilan aplikasi mobile dengan pengaturan warna dan banner yang telah dikonfigurasi.</p>
                                            
                                            <div class="form-group">
                                                <label>Nomor Tujuan</label>
                                                <input type="text" class="form-control" placeholder="08xxxxxxxxxx">
                                            </div>
                                            
                                            <button class="btn btn-primary" style="width: 100%;">Lanjutkan</button>
                                        </div>
                                        <div class="mobile-nav">
                                            <div class="mobile-nav-item active">
                                                <i class="fas fa-home"></i>
                                                <span>Home</span>
                                            </div>
                                            <div class="mobile-nav-item">
                                                <i class="fas fa-history"></i>
                                                <span>Riwayat</span>
                                            </div>
                                            <div class="mobile-nav-item">
                                                <i class="fas fa-user"></i>
                                                <span>Profil</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Produk Code Section -->
                        <div id="produkcodeSection" class="section hidden">
                            <!-- ... existing produkcode content ... -->
                        </div>
                        
                        <!-- Provider Prefix Section -->
                        <div id="prefixSection" class="section hidden">
                            <!-- ... existing prefix content ... -->
                        </div>
                        
                        <!-- Container untuk konten dinamis -->
                        <div id="dynamicContent" class="dynamic-content">
                            <div class="loading-content">
                                <div class="spinner"></div>
                                <p>Memuat konten...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Loading Indicator -->
                    <div id="loadingIndicator" class="loading hidden">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
            
            <footer>
                <p>Â© 2023 ASIA PAYMENT - Console Admin. Hak Cipta Dilindungi.</p>
            </footer>
        </div>
    </div>
    
    <!-- Category Form Modal -->
    <div id="categoryModal" class="modal hidden">
        <!-- ... existing category modal ... -->
    </div>
    
    <!-- Menu Form Modal -->
    <div id="menuModal" class="modal hidden">
        <!-- ... existing menu modal ... -->
    </div>

    <script>
        // Konfigurasi Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBfLp7f8kqjI6jYp1y1XJkY7Z1bLd8l4hQ",
            authDomain: "steady-fin-368617.firebaseapp.com",
            databaseURL: "https://steady-fin-368617-default-rtdb.firebaseio.com",
            projectId: "steady-fin-368617",
            storageBucket: "steady-fin-368617.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdefghijklmnopqrstuv"
        };
        
        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const dbRef = database.ref('AsiaPayment/MenuDinamis');
        const prefixRef = database.ref('AsiaPayment/prefikTujuan');
        const bannerRef = database.ref('AsiaPayment/BannerSlide');
        const colorRef = database.ref('AsiaPayment/Color');
        
        // Data structure
        let appData = {
            categories: {},
            menus: {},
            admin: {
                username: "admin",
                password: "password123"
            },
            prefixData: {},
            bannerData: {},
            colorData: {}
        };
        
        // Type descriptions
        const typeDescriptions = {
            PROVIDER_BASED: "Menu dengan pilihan provider dan nominal (contoh: Pulsa Reguler)",
            STATIC_PRODUCT: "Menu produk statis tanpa input (contoh: Token PLN)",
            POSTPAID_BILL: "Menu untuk pembayaran tagihan (contoh: Tagihan PLN)",
            DYNAMIC_PRODUCT_BASED_ON_NUMBER: "Menu produk dinamis berdasarkan nomor (contoh: Digipos)",
            VOUCHER_AKTIVATION: "Menu aktivasi voucher (contoh: Voucher Kosong)",
            URL: "Menu yang mengarahkan ke URL eksternal",
            DYNAMIC_PRODUCT_BASED_ON_REGION: "Menu produk PDAM berbasis hierarki wilayah (Provinsi -> Kota -> Cabang)"
        };
        
        // Current state
        let currentCategory = null;
        let currentMenu = null;
        let editingMode = false;
        let currentBannerKey = null;
        
        // DOM Elements
        const loginSection = document.getElementById('loginSection');
        const appSection = document.getElementById('appSection');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const alertMessage = document.getElementById('alertMessage');
        const loginAlert = document.getElementById('loginAlert');
        const typeDescription = document.getElementById('typeDescription');
        const urlForm = document.getElementById('urlForm');
        const menuTypeSelect = document.getElementById('menuType');
        const firebaseUrl = document.getElementById('firebaseUrl');
        
        // Initialize application
        function initApp() {
            firebaseUrl.textContent = firebaseConfig.databaseURL;
            
            // Check session
            const session = localStorage.getItem('adminSession');
            if (session) {
                loginSection.classList.add('hidden');
                appSection.classList.remove('hidden');
                document.getElementById('userName').textContent = JSON.parse(session).username;
                
                loadData();
            }
            
            // Setup event listeners
            if (menuTypeSelect) {
                menuTypeSelect.addEventListener('change', function() {
                    updateTypeDescription();
                    updateFormByType();
                });
            }
        }
        
        // Update type description
        function updateTypeDescription() {
            const selectedType = menuTypeSelect.value;
            typeDescription.textContent = typeDescriptions[selectedType];
            
            // Show/hide URL form
            if (selectedType === "URL") {
                urlForm.classList.remove('hidden');
            } else {
                urlForm.classList.add('hidden');
            }
        }
        
        // Update form berdasarkan tipe
        function updateFormByType() {
            const selectedType = menuTypeSelect.value;
            
            // Sembunyikan semua form khusus
            urlForm.classList.add('hidden');
            
            // Tampilkan form yang sesuai
            if (selectedType === "URL") {
                urlForm.classList.remove('hidden');
            }
            
            // Update deskripsi tipe
            typeDescription.textContent = typeDescriptions[selectedType];
        }
        
        // Dapatkan data menu saat ini (untuk edit) atau kosong (untuk tambah)
        function getCurrentMenuData() {
            if (editingMode && currentCategory && currentMenu) {
                return appData.menus[currentCategory][currentMenu];
            }
            return null;
        }
        
        // Login function
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === appData.admin.username && password === appData.admin.password) {
                // Successful login
                loginSection.classList.add('hidden');
                appSection.classList.remove('hidden');
                document.getElementById('userName').textContent = username;
                
                // Save session
                localStorage.setItem('adminSession', JSON.stringify({
                    username: username,
                    loggedIn: true,
                    timestamp: Date.now()
                }));
                
                loadData();
            } else {
                // Failed login
                alertMessage.textContent = "Username atau password salah";
                loginAlert.classList.remove('hidden');
            }
        }
        
        // Logout function
        function logout() {
            // Clear session
            localStorage.removeItem('adminSession');
            
            appSection.classList.add('hidden');
            loginSection.classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            loginAlert.classList.add('hidden');
        }
        
        // Show loading indicator
        function showLoading() {
            loadingIndicator.classList.remove('hidden');
        }
        
        // Hide loading indicator
        function hideLoading() {
            loadingIndicator.classList.add('hidden');
        }
        
        // Load data from Firebase
        function loadData() {
            showLoading();
            
            // Load categories from Firebase
            dbRef.child('category').once('value').then(snapshot => {
                appData.categories = snapshot.val() || {};
                
                // Load menus from Firebase
                dbRef.child('Menu').once('value').then(snapshot => {
                    appData.menus = snapshot.val() || {};
                    
                    // Load prefix data
                    prefixRef.once('value').then(snapshot => {
                        appData.prefixData = snapshot.val() || {};
                        
                        // Load banner data
                        bannerRef.once('value').then(snapshot => {
                            appData.bannerData = snapshot.val() || {};
                            
                            // Load color data
                            colorRef.once('value').then(snapshot => {
                                appData.colorData = snapshot.val() || {};
                                
                                // Update UI
                                updateDashboardStats();
                                renderCategories();
                                renderMenus();
                                renderPrefixData();
                                renderBannerData();
                                renderColorData();
                                updatePreview();
                                hideLoading();
                            });
                        });
                    }).catch(error => {
                        console.error("Error loading prefix data:", error);
                        hideLoading();
                    });
                }).catch(error => {
                    console.error("Error loading menus:", error);
                    hideLoading();
                });
            }).catch(error => {
                console.error("Error loading categories:", error);
                hideLoading();
            });
        }
        
        // Refresh data
        function refreshData() {
            showLoading();
            loadData();
        }
        
        // Update dashboard statistics
        function updateDashboardStats() {
            const categoryCount = Object.keys(appData.categories).length;
            let menuCount = 0;
            
            for (const category in appData.menus) {
                menuCount += Object.keys(appData.menus[category]).length;
            }
            
            document.getElementById('categoryCount').textContent = `${categoryCount} Kategori`;
            document.getElementById('menuCount').textContent = `${menuCount} Menu`;
        }
        
        // Fungsi untuk memuat konten dinamis
        function loadContent(page) {
            // Sembunyikan semua konten
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById('dynamicContent').classList.remove('active');
            
            // Tampilkan indikator loading
            showLoading();
            
            // Update menu aktif
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Handle specific pages
            switch(page) {
                case 'dashboard':
                    document.getElementById('dashboardSection').classList.remove('hidden');
                    hideLoading();
                    break;
                case 'categories':
                    document.getElementById('categoriesSection').classList.remove('hidden');
                    hideLoading();
                    break;
                case 'menus':
                    document.getElementById('menusSection').classList.remove('hidden');
                    hideLoading();
                    break;
                case 'settings':
                    document.getElementById('settingsSection').classList.remove('hidden');
                    hideLoading();
                    break;
                case 'uidisplay':
                    document.getElementById('uidisplaySection').classList.remove('hidden');
                    hideLoading();
                    break;
                case 'produkcode':
                    document.getElementById('produkcodeSection').classList.remove('hidden');
                    hideLoading();
                    break;
                case 'prefix':
                    document.getElementById('prefixSection').classList.remove('hidden');
                    hideLoading();
                    break;
                default:
                    showTemplatePage(page);
                    hideLoading();
            }
        }
        
        // Tampilkan halaman template untuk menu baru
        function showTemplatePage(pageName) {
            const dynamicContent = document.getElementById('dynamicContent');
            const pageTitles = {
                regex: "Regex Extractor",
                textinfo: "Informasi Teks",
                cs: "Customer Service",
                serverconfig: "Konfigurasi Server"
            };
            
            const pageIcons = {
                regex: "fa-code",
                textinfo: "fa-info-circle",
                cs: "fa-headset",
                serverconfig: "fa-server"
            };
            
            dynamicContent.innerHTML = `
                <div class="section">
                    <div class="section-title">
                        <h2><i class="fas ${pageIcons[pageName]}"></i> ${pageTitles[pageName]}</h2>
                        <button class="btn btn-primary">
                            <i class="fas fa-plus"></i> Tambah Baru
                        </button>
                    </div>
                    
                    <div class="card">
                        <div class="page-template">
                            <h2>Halaman ${pageTitles[pageName]}</h2>
                            <p>Halaman ini sedang dalam pengembangan. Silakan tambahkan fungsionalitas sesuai kebutuhan.</p>
                            <p>Anda bisa mulai dengan menambahkan form dan tabel untuk mengelola data.</p>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                <strong>Tips Pengembangan</strong>
                                <p>1. Buat form input data</p>
                                <p>2. Tambahkan tabel untuk menampilkan data</p>
                                <p>3. Hubungkan dengan Firebase Realtime Database</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            dynamicContent.classList.add('active');
        }
        
        // Render categories table
        function renderCategories() {
            const tbody = document.getElementById('categoriesTableBody');
            tbody.innerHTML = '';
            
            // Populate category filter in menus section
            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '<option value="">Semua Kategori</option>';
            
            // Populate category select in menu form
            const menuCategory = document.getElementById('menuCategory');
            menuCategory.innerHTML = '';
            
            for (const categoryName in appData.categories) {
                const category = appData.categories[categoryName];
                const menuCount = appData.menus[categoryName] ? Object.keys(appData.menus[categoryName]).length : 0;
                
                // Add to table
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${categoryName}</td>
                    <td>${category.Urutan || 1}</td>
                    <td>${menuCount}</td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editCategory('${categoryName}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-delete btn-sm" onclick="deleteCategory('${categoryName}')">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
                
                // Add to filter dropdown
                const filterOption = document.createElement('option');
                filterOption.value = categoryName;
                filterOption.textContent = categoryName;
                categoryFilter.appendChild(filterOption.cloneNode(true));
                
                // Add to menu form dropdown
                const formOption = document.createElement('option');
                formOption.value = categoryName;
                formOption.textContent = categoryName;
                menuCategory.appendChild(formOption);
            }
        }
        
        // Open category form
        function openCategoryForm(categoryName = null) {
            const modalTitle = document.getElementById('categoryModalTitle');
            const modal = document.getElementById('categoryModal');
            
            if (categoryName) {
                // Edit mode
                modalTitle.textContent = "Edit Kategori";
                const category = appData.categories[categoryName];
                document.getElementById('categoryName').value = categoryName;
                document.getElementById('categoryOrder').value = category.Urutan || 1;
                currentCategory = categoryName;
                editingMode = true;
            } else {
                // Add mode
                modalTitle.textContent = "Tambah Kategori Baru";
                document.getElementById('categoryName').value = "";
                document.getElementById('categoryOrder').value = "";
                currentCategory = null;
                editingMode = false;
            }
            
            modal.classList.remove('hidden');
        }
        
        // Close category modal
        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.add('hidden');
        }
        
        // Save category to Firebase
        function saveCategory() {
            const name = document.getElementById('categoryName').value;
            const urutan = parseInt(document.getElementById('categoryOrder').value) || 1;
            
            if (!name) {
                alert("Nama kategori harus diisi!");
                return;
            }
            
            showLoading();
            
            if (editingMode) {
                // If name changed, update references
                if (name !== currentCategory) {
                    // Update category name in all places
                    if (appData.categories[currentCategory]) {
                        appData.categories[name] = {...appData.categories[currentCategory]};
                        delete appData.categories[currentCategory];
                    }
                    
                    // Update menus
                    if (appData.menus[currentCategory]) {
                        appData.menus[name] = {...appData.menus[currentCategory]};
                        delete appData.menus[currentCategory];
                    }
                }
                
                // Update order
                appData.categories[name].Urutan = urutan;
            } else {
                // Add new category
                appData.categories[name] = { Urutan: urutan };
                
                // Initialize empty menu object for this category
                if (!appData.menus[name]) {
                    appData.menus[name] = {};
                }
            }
            
            // Save to Firebase
            dbRef.child('category').set(appData.categories)
                .then(() => {
                    return dbRef.child('Menu').set(appData.menus);
                })
                .then(() => {
                    // Save and refresh
                    renderCategories();
                    closeCategoryModal();
                    hideLoading();
                })
                .catch(error => {
                    console.error("Error saving category:", error);
                    alert("Gagal menyimpan kategori ke Firebase");
                    hideLoading();
                });
        }
        
        // Edit category
        function editCategory(categoryName) {
            openCategoryForm(categoryName);
        }
        
        // Delete category from Firebase
        function deleteCategory(categoryName) {
            if (!confirm(`Apakah Anda yakin ingin menghapus kategori "${categoryName}"? Semua menu dalam kategori ini juga akan dihapus.`)) {
                return;
            }
            
            showLoading();
            
            delete appData.categories[categoryName];
            delete appData.menus[categoryName];
            
            // Save to Firebase
            dbRef.child('category').set(appData.categories)
                .then(() => {
                    return dbRef.child('Menu').set(appData.menus);
                })
                .then(() => {
                    renderCategories();
                    renderMenus();
                    hideLoading();
                })
                .catch(error => {
                    console.error("Error deleting category:", error);
                    alert("Gagal menghapus kategori dari Firebase");
                    hideLoading();
                });
        }
        
        // Render menus table
        function renderMenus() {
            const tbody = document.getElementById('menusTableBody');
            tbody.innerHTML = '';
            
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            for (const categoryName in appData.menus) {
                if (categoryFilter && categoryFilter !== categoryName) continue;
                
                const menus = appData.menus[categoryName];
                
                for (const menuName in menus) {
                    const menu = menus[menuName];
                    
                    // Get badge class based on type
                    let badgeClass = '';
                    switch(menu.type) {
                        case 'PROVIDER_BASED': badgeClass = 'badge-provider'; break;
                        case 'STATIC_PRODUCT': badgeClass = 'badge-static'; break;
                        case 'POSTPAID_BILL': badgeClass = 'badge-postpaid'; break;
                        case 'DYNAMIC_PRODUCT_BASED_ON_NUMBER': badgeClass = 'badge-dynamic'; break;
                        case 'VOUCHER_AKTIVATION': badgeClass = 'badge-voucher'; break;
                        case 'URL': badgeClass = 'badge-url'; break;
                        case 'DYNAMIC_PRODUCT_BASED_ON_REGION': badgeClass = 'badge-region'; break;
                        default: badgeClass = 'badge';
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${menuName}</td>
                        <td>${categoryName}</td>
                        <td><span class="badge ${badgeClass}">${menu.type}</span></td>
                        <td>${menu.order || 1}</td>
                        <td class="action-buttons">
                            <button class="btn btn-edit btn-sm" onclick="editMenu('${categoryName}', '${menuName}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-delete btn-sm" onclick="deleteMenu('${categoryName}', '${menuName}')">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                }
            }
        }
        
        // Filter menus by category
        function filterMenus() {
            renderMenus();
        }
        
        // Open menu form
        function openMenuForm(categoryName = null, menuName = null) {
            const modalTitle = document.getElementById('menuModalTitle');
            const modal = document.getElementById('menuModal');
            
            // Reset form
            document.getElementById('menuName').value = "";
            document.getElementById('menuIconUrl').value = "";
            document.getElementById('menuOrder').value = "1";
            document.getElementById('urlTarget').value = "";
            urlForm.classList.add('hidden');
            
            if (categoryName && menuName) {
                // Edit mode
                modalTitle.textContent = "Edit Menu";
                const menu = appData.menus[categoryName][menuName];
                
                document.getElementById('menuCategory').value = categoryName;
                document.getElementById('menuName').value = menuName;
                document.getElementById('menuIconUrl').value = menu.iconUrl || "";
                document.getElementById('menuOrder').value = menu.order || 1;
                document.getElementById('menuType').value = menu.type;
                
                // Populate URL if type is URL
                if (menu.type === "URL") {
                    document.getElementById('urlTarget').value = menu.url || "";
                    urlForm.classList.remove('hidden');
                }
                
                currentCategory = categoryName;
                currentMenu = menuName;
                editingMode = true;
            } else {
                // Add mode
                modalTitle.textContent = "Tambah Menu Baru";
                document.getElementById('menuCategory').value = "";
                document.getElementById('menuType').value = "URL"; // Default to URL type
                currentCategory = null;
                currentMenu = null;
                editingMode = false;
            }
            
            // Update form berdasarkan tipe
            updateFormByType();
            
            // Update type description
            updateTypeDescription();
            modal.classList.remove('hidden');
        }
        
        // Close menu modal
        function closeMenuModal() {
            document.getElementById('menuModal').classList.add('hidden');
        }
        
        // Save menu to Firebase
        function saveMenu() {
            const category = document.getElementById('menuCategory').value;
            const name = document.getElementById('menuName').value;
            const iconUrl = document.getElementById('menuIconUrl').value;
            const type = document.getElementById('menuType').value;
            const order = parseInt(document.getElementById('menuOrder').value) || 1;
            
            if (!category || !name || !type) {
                alert("Kategori, nama menu, dan tipe harus diisi!");
                return;
            }
            
            // Create menu object
            const menu = {
                type: type,
                iconUrl: iconUrl,
                order: order
            };
            
            // Add URL if type is URL
            if (type === "URL") {
                const url = document.getElementById('urlTarget').value;
                if (!url) {
                    alert("URL Tujuan harus diisi untuk tipe URL!");
                    return;
                }
                menu.url = url;
            }
            
            showLoading();
            
            // Ensure category exists in menus
            if (!appData.menus[category]) {
                appData.menus[category] = {};
            }
            
            if (editingMode) {
                // If name changed, update references
                if (name !== currentMenu) {
                    // Delete old menu if name changed
                    delete appData.menus[currentCategory][currentMenu];
                }
                
                // Add new/updated menu
                appData.menus[category][name] = menu;
            } else {
                // Add new menu
                appData.menus[category][name] = menu;
            }
            
            // Save to Firebase
            dbRef.child('Menu').set(appData.menus)
                .then(() => {
                    // Save and refresh
                    renderMenus();
                    closeMenuModal();
                    hideLoading();
                })
                .catch(error => {
                    console.error("Error saving menu:", error);
                    alert("Gagal menyimpan menu ke Firebase");
                    hideLoading();
                });
        }
        
        // Edit menu
        function editMenu(categoryName, menuName) {
            openMenuForm(categoryName, menuName);
        }
        
        // Delete menu from Firebase
        function deleteMenu(categoryName, menuName) {
            if (!confirm(`Apakah Anda yakin ingin menghapus menu "${menuName}"?`)) {
                return;
            }
            
            showLoading();
            
            if (appData.menus[categoryName] && appData.menus[categoryName][menuName]) {
                delete appData.menus[categoryName][menuName];
            }
            
            // Save to Firebase
            dbRef.child('Menu').set(appData.menus)
                .then(() => {
                    renderMenus();
                    hideLoading();
                })
                .catch(error => {
                    console.error("Error deleting menu:", error);
                    alert("Gagal menghapus menu dari Firebase");
                    hideLoading();
                });
        }
        
        // Update admin account
        function updateAdminAccount() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            const passwordConfirm = document.getElementById('adminPasswordConfirm').value;
            
            if (!username) {
                alert("Username tidak boleh kosong!");
                return;
            }
            
            if (password && password !== passwordConfirm) {
                alert("Password dan konfirmasi password tidak cocok!");
                return;
            }
            
            appData.admin.username = username;
            if (password) {
                appData.admin.password = password;
            }
            
            alert("Akun admin berhasil diperbarui!");
        }
        
        // ================ TAMPILAN UI FUNCTIONS ================
        function switchUiTab(tabName) {
            // Hide all tabs
            document.getElementById('bannerTab').classList.remove('active');
            document.getElementById('colorTab').classList.remove('active');
            document.getElementById('previewTab').classList.remove('active');
            
            // Remove active class from all tabs
            document.querySelectorAll('.ui-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activate selected tab
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.currentTarget.classList.add('active');
            
            // If preview tab, update the preview
            if (tabName === 'preview') {
                updatePreview();
            }
        }
        
        function renderBannerData() {
            const bannerList = document.getElementById('bannerList');
            bannerList.innerHTML = '';
            
            // Set interval value
            if (appData.bannerData.IntervalPerdetik) {
                document.getElementById('bannerInterval').value = appData.bannerData.IntervalPerdetik;
            }
            
            // Render banners
            for (const key in appData.bannerData) {
                if (key === 'IntervalPerdetik') continue;
                
                const bannerUrl = appData.bannerData[key];
                
                const bannerItem = document.createElement('div');
                bannerItem.className = 'banner-item';
                bannerItem.innerHTML = `
                    <img src="${bannerUrl}" alt="Banner ${key}">
                    <div class="banner-item-details">
                        <strong>Banner ${key}</strong>
                        <div>${bannerUrl}</div>
                    </div>
                    <div class="banner-item-actions">
                        <button class="btn btn-edit btn-sm" onclick="editBanner('${key}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-delete btn-sm" onclick="deleteBanner('${key}')">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </div>
                `;
                bannerList.appendChild(bannerItem);
            }
        }
        
        function renderColorData() {
            // Set gradient colors
            if (appData.colorData.BackgroundGradient) {
                const gradients = appData.colorData.BackgroundGradient;
                document.getElementById('gradientColor1').value = gradients[0] || '#ffffff';
                document.getElementById('gradientColor2').value = gradients[1] || '#FF3537';
                document.getElementById('gradientColor3').value = gradients[2] || '#FEB400';
                document.getElementById('gradientColor4').value = gradients[3] || '#FA2F62';
            }
            
            // Set color scheme
            if (appData.colorData.ColorScheme) {
                const scheme = appData.colorData.ColorScheme;
                document.getElementById('primaryColor').value = scheme.primaryColor || '#FEB400';
                document.getElementById('secondaryColor').value = scheme.secondaryColor || '#ff5722';
                document.getElementById('textColor').value = scheme.textColor || '#212121';
            }
        }
        
        function addBanner() {
            const bannerUrl = document.getElementById('newBannerUrl').value.trim();
            
            if (!bannerUrl) {
                alert('URL banner tidak boleh kosong!');
                return;
            }
            
            showLoading();
            
            // Find the next available key
            let maxKey = 0;
            for (const key in appData.bannerData) {
                if (key !== 'IntervalPerdetik' && parseInt(key) > maxKey) {
                    maxKey = parseInt(key);
                }
            }
            const newKey = (maxKey + 1).toString();
            
            // Add to data and update Firebase
            appData.bannerData[newKey] = bannerUrl;
            
            bannerRef.set(appData.bannerData)
                .then(() => {
                    renderBannerData();
                    document.getElementById('newBannerUrl').value = '';
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error adding banner:', error);
                    alert('Gagal menambahkan banner');
                    hideLoading();
                });
        }
        
        function editBanner(key) {
            const bannerUrl = prompt('Edit URL Banner:', appData.bannerData[key]);
            
            if (bannerUrl !== null) {
                showLoading();
                
                appData.bannerData[key] = bannerUrl;
                
                bannerRef.set(appData.bannerData)
                    .then(() => {
                        renderBannerData();
                        hideLoading();
                    })
                    .catch(error => {
                        console.error('Error editing banner:', error);
                        alert('Gagal mengedit banner');
                        hideLoading();
                    });
            }
        }
        
        function deleteBanner(key) {
            if (confirm('Apakah Anda yakin ingin menghapus banner ini?')) {
                showLoading();
                
                delete appData.bannerData[key];
                
                bannerRef.set(appData.bannerData)
                    .then(() => {
                        renderBannerData();
                        hideLoading();
                    })
                    .catch(error => {
                        console.error('Error deleting banner:', error);
                        alert('Gagal menghapus banner');
                        hideLoading();
                    });
            }
        }
        
        function saveBannerInterval() {
            const interval = document.getElementById('bannerInterval').value;
            
            showLoading();
            
            appData.bannerData.IntervalPerdetik = parseInt(interval);
            
            bannerRef.set(appData.bannerData)
                .then(() => {
                    alert('Interval berhasil disimpan');
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error saving interval:', error);
                    alert('Gagal menyimpan interval');
                    hideLoading();
                });
        }
        
        function saveColorSettings() {
            showLoading();
            
            const gradientColors = [
                document.getElementById('gradientColor1').value,
                document.getElementById('gradientColor2').value,
                document.getElementById('gradientColor3').value,
                document.getElementById('gradientColor4').value
            ];
            
            const colorScheme = {
                primaryColor: document.getElementById('primaryColor').value,
                secondaryColor: document.getElementById('secondaryColor').value,
                textColor: document.getElementById('textColor').value
            };
            
            appData.colorData = {
                BackgroundGradient: gradientColors,
                ColorScheme: colorScheme
            };
            
            colorRef.set(appData.colorData)
                .then(() => {
                    alert('Pengaturan warna berhasil disimpan');
                    hideLoading();
                })
                .catch(error => {
                    console.error('Error saving color settings:', error);
                    alert('Gagal menyimpan pengaturan warna');
                    hideLoading();
                });
        }
        
        function updatePreview() {
            // Update banner preview
            const previewBanner = document.getElementById('previewBanner');
            previewBanner.innerHTML = '';
            
            // Get first banner for preview
            for (const key in appData.bannerData) {
                if (key !== 'IntervalPerdetik') {
                    const bannerImg = document.createElement('img');
                    bannerImg.src = appData.bannerData[key];
                    bannerImg.alt = 'Banner Preview';
                    previewBanner.appendChild(bannerImg);
                    break;
                }
            }
            
            // Update color preview
            if (appData.colorData.ColorScheme) {
                const scheme = appData.colorData.ColorScheme;
                document.getElementById('previewHeader').style.backgroundColor = scheme.primaryColor;
                
                // Update buttons in preview
                const previewButtons = document.querySelectorAll('.mobile-content .btn');
                previewButtons.forEach(btn => {
                    btn.style.backgroundColor = scheme.primaryColor;
                });
                
                // Update active nav item
                const activeNav = document.querySelector('.mobile-nav-item.active');
                activeNav.style.color = scheme.primaryColor;
            }
            
            // Update gradient background if available
            if (appData.colorData.BackgroundGradient) {
                const gradients = appData.colorData.BackgroundGradient;
                const gradientStr = `linear-gradient(135deg, ${gradients[0]}, ${gradients[1]}, ${gradients[2]}, ${gradients[3]})`;
                document.querySelector('.mobile-preview').style.background = gradientStr;
            }
        }
        
        // ================ KODE PRODUK FUNCTIONS ================
        function loadMenus() {
            const typeSelect = document.getElementById("typeSelect");
            const selectedType = typeSelect.value;
            const menuSelect = document.getElementById("menuSelect");
            menuSelect.innerHTML = '<option value="">--Pilih Kategori/Menu--</option>';
            
            if (!selectedType) {
                hideAllSections();
                return;
            }
            
            const providerSection = document.getElementById("providerSection");
            const billSection = document.getElementById("billSection");
            const produkSection = document.getElementById("produkSection");
            const regionSection = document.getElementById("regionSection");
            const codeSection = document.getElementById("codeSection");
            
            const ref = dbRef.child("Menu");
            ref.once("value").then(snapshot => {
                const data = snapshot.val();
                let found = false;
                
                for (const category in data) {
                    for (const menuName in data[category]) {
                        const menu = data[category][menuName];
                        if (menu.type === selectedType) {
                            const opt = document.createElement("option");
                            opt.value = `${category}|${menuName}`;
                            opt.textContent = `${category} / ${menuName}`;
                            menuSelect.appendChild(opt);
                            found = true;
                        }
                    }
                }
                
                if (!found) {
                    const opt = document.createElement("option");
                    opt.value = "";
                    opt.textContent = "Tidak ada menu untuk tipe ini";
                    menuSelect.appendChild(opt);
                }
                
                // Tampilkan/hide section berdasarkan type
                providerSection.classList.toggle('hidden', selectedType !== "PROVIDER_BASED");
                billSection.classList.toggle('hidden', 
                    selectedType !== "POSTPAID_BILL" && 
                    selectedType !== "DYNAMIC_PRODUCT_BASED_ON_NUMBER"
                );
                regionSection.classList.toggle('hidden', selectedType !== "DYNAMIC_PRODUCT_BASED_ON_REGION");
                produkSection.classList.toggle('hidden', selectedType === "DYNAMIC_PRODUCT_BASED_ON_REGION");
                codeSection.classList.toggle('hidden', 
                    selectedType !== "PROVIDER_BASED" && 
                    selectedType !== "STATIC_PRODUCT" && 
                    selectedType !== "VOUCHER_AKTIVATION" && 
                    selectedType !== "URL"
                );
                
            }).catch(error => {
                showNotification(`Error: ${error.message}`, 'error');
            });
        }
        
        function hideAllSections() {
            const providerSection = document.getElementById("providerSection");
            const billSection = document.getElementById("billSection");
            const regionSection = document.getElementById("regionSection");
            const codeSection = document.getElementById("codeSection");
            
            providerSection.classList.add('hidden');
            billSection.classList.add('hidden');
            regionSection.classList.add('hidden');
            codeSection.remove('hidden');
        }
        
        function showNotification(message, type) {
            const notification = document.getElementById("notification");
            notification.textContent = message;
            notification.className = `notification ${type}`;
            
            // Sembunyikan notifikasi setelah 5 detik
            setTimeout(() => {
                notification.classList.remove('success', 'error');
                notification.style.display = 'none';
            }, 5000);
        }
        
        function simpanProduk() {
            const typeSelect = document.getElementById("typeSelect");
            const menuSelect = document.getElementById("menuSelect");
            const type = typeSelect.value;
            const menuVal = menuSelect.value;
            
            if (!type || !menuVal) {
                showNotification("Type dan Menu harus dipilih!", 'error');
                return;
            }
            
            const provider = document.getElementById("providerPrefik").value.trim();
            const namaProduk = document.getElementById("namaProduk").value.trim();
            const code = document.getElementById("codeProduk").value.trim();
            const imageUrl = document.getElementById("imageUrl").value.trim();
            const ket = document.getElementById("keterangan").value.trim();
            
            const [category, menuName] = menuVal.split("|");
            
            // Struktur data dasar
            const produkData = { ImageUrl: imageUrl, Ket: ket };
            let path;
            
            if (type === "PROVIDER_BASED") {
                if (!provider || !namaProduk || !code) {
                    showNotification("Provider, Nama Produk, dan Code wajib diisi untuk PROVIDER_BASED", 'error');
                    return;
                }
                produkData.Code = code;
                path = `ItemsCode/${type}/${category}/${menuName}/${provider}/${namaProduk}`;
            } 
            else if (type === "POSTPAID_BILL" || type === "DYNAMIC_PRODUCT_BASED_ON_NUMBER") {
                const kodeBayar = document.getElementById("kodeBayar").value.trim();
                const kodeCek = document.getElementById("kodeCek").value.trim();
                
                if (!namaProduk || !kodeBayar || !kodeCek) {
                    showNotification("Nama Produk, Kode Bayar, dan Kode Cek wajib diisi untuk " + type, 'error');
                    return;
                }
                
                produkData.KodeBayar = kodeBayar;
                produkData.KodeCek = kodeCek;
                path = `ItemsCode/${type}/${category}/${menuName}/${namaProduk}`;
            }
            else if (type === "DYNAMIC_PRODUCT_BASED_ON_REGION") {
                const namaKota = document.getElementById("namaProdukRegion").value.trim();
                const namaWilayah = document.getElementById("namaWilayah").value.trim();
                const kodeBayarRegion = document.getElementById("kodeBayarRegion").value.trim();
                const kodeCekRegion = document.getElementById("kodeCekRegion").value.trim();
                
                if (!namaKota || !namaWilayah || !kodeBayarRegion || !kodeCekRegion) {
                    showNotification("Nama Kota, Wilayah, Kode Bayar, dan Kode Cek wajib diisi untuk DYNAMIC_PRODUCT_BASED_ON_REGION", 'error');
                    return;
                }
                
                produkData.KodeBayar = kodeBayarRegion;
                produkData.KodeCek = kodeCekRegion;
                path = `ItemsCode/${type}/${category}/${menuName}/${namaKota}/Wilayah/${namaWilayah}`;
            }
            else {
                if (!namaProduk || !code) {
                    showNotification("Nama Produk dan Code wajib diisi untuk type ini", 'error');
                    return;
                }
                produkData.Code = code;
                path = `ItemsCode/${type}/${category}/${menuName}/${namaProduk}`;
            }
            
            showLoading();
            
            dbRef.child(path).set(produkData)
                .then(() => {
                    showNotification("Produk berhasil disimpan ke Firebase!", 'success');
                    // Reset form
                    document.querySelectorAll('input').forEach(input => {
                        if (input.id !== 'typeSelect') input.value = '';
                    });
                    hideLoading();
                })
                .catch(err => {
                    console.error(err);
                    showNotification("Gagal menyimpan produk: " + err.message, 'error');
                    hideLoading();
                });
        }
        
        // ================ PROVIDER PREFIX FUNCTIONS ================
        function simpanPrefik() {
            const provider = document.getElementById("providerName").value.trim();
            const prefix = document.getElementById("prefixValue").value.trim();
            
            if (!provider || !prefix) {
                showPrefixNotification("Nama Provider dan Prefik wajib diisi!", 'error');
                return;
            }
            
            showLoading();
            
            prefixRef.child(provider).set(prefix)
                .then(() => {
                    showPrefixNotification("Prefik berhasil disimpan ke Database!", 'success');
                    document.getElementById("providerName").value = "";
                    document.getElementById("prefixValue").value = "";
                    loadPrefixData();
                    hideLoading();
                })
                .catch(err => {
                    console.error(err);
                    showPrefixNotification("Gagal simpan ke Database: " + err.message, 'error');
                    hideLoading();
                });
        }
        
        function refreshPrefixData() {
            showLoading();
            loadPrefixData();
        }
        
        function loadPrefixData() {
            prefixRef.once("value").then(snapshot => {
                appData.prefixData = snapshot.val() || {};
                renderPrefixData();
                hideLoading();
            }).catch(error => {
                console.error("Error loading prefix data:", error);
                showPrefixNotification("Gagal memuat data prefik", 'error');
                hideLoading();
            });
        }
        
        function renderPrefixData() {
            const tbody = document.getElementById("prefixTableBody");
            tbody.innerHTML = "";
            
            for (const provider in appData.prefixData) {
                const prefix = appData.prefixData[provider];
                
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${provider}</td>
                    <td>${prefix}</td>
                    <td class="action-buttons">
                        <button class="btn btn-edit btn-sm" onclick="editPrefix('${provider}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-delete btn-sm" onclick="deletePrefix('${provider}')">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            }
        }
        
        function editPrefix(provider) {
            document.getElementById("providerName").value = provider;
            document.getElementById("prefixValue").value = appData.prefixData[provider] || "";
        }
        
        function deletePrefix(provider) {
            if (!confirm(`Apakah Anda yakin ingin menghapus provider "${provider}"?`)) {
                return;
            }
            
            showLoading();
            
            prefixRef.child(provider).remove()
                .then(() => {
                    showPrefixNotification("Provider berhasil dihapus", 'success');
                    loadPrefixData();
                })
                .catch(error => {
                    console.error("Error deleting prefix:", error);
                    showPrefixNotification("Gagal menghapus provider", 'error');
                    hideLoading();
                });
        }
        
        function showPrefixNotification(message, type) {
            const notification = document.getElementById("prefixNotification");
            notification.textContent = message;
            notification.className = `notification ${type}`;
            
            // Sembunyikan notifikasi setelah 5 detik
            setTimeout(() => {
                notification.classList.remove('success', 'error');
                notification.style.display = 'none';
            }, 5000);
        }
        
        // Initialize the app
        initApp();
    </script>
</body>
</html>
